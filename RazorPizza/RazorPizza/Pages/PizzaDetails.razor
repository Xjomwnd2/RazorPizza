@page "/pizza/{PizzaId:int}"
@using RazorPizza.Models
@using RazorPizza.Services
@inject IPizzaService PizzaService
@inject NavigationManager Navigation

<PageTitle>@pizza?.Name - Razor Pizza</PageTitle>

<div class="container my-5">
    @if (loading)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }
    else if (pizza == null)
    {
        <div class="alert alert-danger">
            <h4>Pizza not found!</h4>
            <button class="btn btn-primary" @onclick='() => Navigation.NavigateTo("/menu")'>
                Back to Menu
            </button>
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-md-6">
                <img src="@pizza.ImageUrl" class="img-fluid rounded shadow" alt="@pizza.Name" />
            </div>
            <div class="col-md-6">
                <h1 class="display-4 fw-bold">@pizza.Name</h1>
                <p class="lead text-muted">@pizza.Description</p>
                <h3 class="text-primary mt-4">$@pizza.BasePrice.ToString("F2")</h3>
                
                @if (pizza.Category != "Custom")
                {
                    <p class="mt-3">
                        <span class="badge bg-secondary">@pizza.Category</span>
                    </p>
                }

                @if (showAddedMessage)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="bi bi-check-circle"></i> Pizza added to cart!
                        <button type="button" class="btn-close" @onclick="() => showAddedMessage = false"></button>
                    </div>
                }

                <div class="mt-4">
                    <button class="btn btn-success btn-lg me-2" @onclick="AddToCart">
                        <i class="bi bi-cart-plus"></i> Add to Cart
                    </button>
                    <button class="btn btn-outline-secondary" @onclick='() => Navigation.NavigateTo("/menu")'>
                        <i class="bi bi-arrow-left"></i> Back to Menu
                    </button>
                </div>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public int PizzaId { get; set; }

    private Pizza? pizza;
    private bool loading = true;
    private bool showAddedMessage = false;

    protected override async Task OnInitializedAsync()
    {
        await LoadPizza();
    }

    private async Task LoadPizza()
    {
        loading = true;
        var allPizzas = await PizzaService.GetAllPizzasAsync();
        pizza = allPizzas.FirstOrDefault(p => p.PizzaId == PizzaId);
        loading = false;
    }

    private void AddToCart()
    {
        if (pizza != null)
        {
            // TODO: Implement actual cart service
            // For now, just show a success message
            showAddedMessage = true;
            
            // Auto-hide message after 3 seconds
            Task.Delay(3000).ContinueWith(_ => 
            {
                showAddedMessage = false;
                InvokeAsync(StateHasChanged);
            });
            
            // Alternative: Navigate to cart page if you have one
            // Navigation.NavigateTo("/cart");
        }
    }
}